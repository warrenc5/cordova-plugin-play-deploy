import groovy.json.JsonSlurper

configurations.all {
  resolutionStrategy {
    cacheChangingModulesFor 0, 'seconds'
    cacheDynamicVersionsFor 0, 'seconds'
  }
}

buildscript {
  dependencies {
    //classpath 'com.android.tools.build:gradle:3.0.0'
    classpath 'com.github.triplet.gradle:play-publisher:1.2.0'
  }

  repositories {
    mavenCentral()
      jcenter()
      maven {
        url "https://maven.google.com"
      }
  }
}

def inputFile = new File("./platforms/android/android.json")
def jsonConfig = new JsonSlurper().parseText(inputFile.text)
def iamFileLocation = jsonConfig.installed_plugins."cordova-plugin-play-deploy".IAM_SERVICE_ACCOUNT_JSON_FILE_LOCATION
def track = jsonConfig.installed_plugins."cordova-plugin-play-deploy".TRACK
def untrackOld = jsonConfig.installed_plugins."cordova-plugin-play-deploy".UNTRACK_OLD

if(track == null) {
  track = 'beta'
}

if(untrackOld == null) {
  untrackOld = false
}
def iamFile = new File(iamFileLocation)
  println "using play account config file " + iamFile.getAbsolutePath() 

android {
  compileSdkVersion = 22
}

//apply plugin: de.triplet.gradle.play.PlayPublisherPlugin
apply plugin: 'com.github.triplet.play'

android {

  playAccountConfigs {
    defaultAccountConfig {
       jsonFile = file(iamFile.getAbsolutePath())
    }
  }

  defaultConfig {

  compileSdkVersion = 16
    playAccountConfig = playAccountConfigs.defaultAccountConfig
  }

  packagingOptions {
    pickFirst "anyFileWillDo"
      exclude "/META-INF/**"
  }
}

play {
  track = track
  untrackOld = untrackOld
}

  
